<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard | Agenda SISREG</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/theme.css">
<link rel="stylesheet" href="css/style.css">
<!-- Bibliotecas externas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- [NOVO - SOMENTE PARA GR√ÅFICOS] D3 + Sankey -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
/* Estilos adicionais para espa√ßamento */
.dashboard-grid {
  margin-top: 30px; /* Espa√ßamento entre KPIs e gr√°ficos */
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
}

.card.full-width {
  grid-column: 1 / -1;
}

/* Bot√£o toggle dentro do card Insights */
#cardInsights .card-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 10px;
}

#cardInsights .card-head h3 {
  margin: 0;
}

/* Tabela oculta por padr√£o */
#secTabela {
  display: none;
}

/* [CORRE√á√ÉO] Posicionamento dos bot√µes na margem direita */
.header-btns {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

/* [NOVO - SOMENTE PARA GR√ÅFICOS] Tooltip D3 */
#vizTooltip{
  position: fixed;
  z-index: 9999;
  pointer-events: none;
  background: rgba(15,16,20,0.92);
  color: #fff;
  padding: 10px 12px;
  border-radius: 10px;
  font-size: 12px;
  line-height: 1.35;
  display: none;
  max-width: 260px;
  box-shadow: 0 10px 25px rgba(0,0,0,.18);
}

  /* Estilos para os novos gr√°ficos */
.gauge-percentage {
  font-size: 36px;
  font-weight: bold;
  color: #27ae60;
  margin: 10px 0;
  text-align: center;
}

.gauge-label {
  font-size: 13px;
  color: #7f8c8d;
  text-align: center;
  margin-top: 5px;
  font-style: italic;
}

.donut-total {
  font-weight: bold;
  font-size: 18px;
  margin: 15px 0 5px;
  text-align: center;
  color: #2c3e50;
}
  /* Estilos para o gr√°fico de evolu√ß√£o mensal */
.chart-subtitle {
  font-size: 14px;
  color: #7f8c8d;
  margin: -8px 0 20px 0;
  font-style: italic;
  text-align: center;
}

.chart-wrapper {
  position: relative;
  height: 400px;
  width: 100%;
  margin-top: 10px;
}

/* Estilos para os outros gr√°ficos */
.gauge-percentage {
  font-size: 36px;
  font-weight: bold;
  color: #27ae60;
  margin: 10px 0;
  text-align: center;
}

.gauge-label {
  font-size: 13px;
  color: #7f8c8d;
  text-align: center;
  margin-top: 5px;
  font-style: italic;
}

.donut-total {
  font-weight: bold;
  font-size: 18px;
  margin: 15px 0 5px;
  text-align: center;
  color: #2c3e50;
}  
</style>
</head>
<body>

<!-- Tooltip para gr√°ficos D3 -->
<div id="vizTooltip"></div>

<!-- HEADER -->
<header class="dash-header">
  <!-- Elementos decorativos -->
  <div class="header-decorative circle-1"></div>
  <div class="header-decorative circle-2"></div>
  <div class="header-decorative circle-3"></div>
    
  <div class="unit-info">
    <h1 id="txtUnidade">Carregando unidade...</h1>
    <div class="gradient-line"></div>
    <p>Painel Gerencial de Escalas ‚Ä¢ <strong>SISREG Amazonas</strong></p>
  </div>

  <div style="display:flex;justify-content:space-between;align-items:center;position:relative;z-index:2;">
    <div class="header-btns">
      <button id="btnSincronizar" class="btn-main btn-sync">üîÑ Sincronizar</button>
      <button id="btnExportarPDF" class="btn-main">üìÑ Exportar PDF</button>
      <a href="escalas.html" style="text-decoration:none;">
      <button class="btn-main btn-new">‚ûï Nova Escala</button>
      </a>
      <button id="btnLogout" class="btn-main btn-logout">Sair</button>
    </div>
  </div>
</header>

<!-- FILTRO -->
<section class="filter-section">
<label for="filtroMes">Filtrar por M√™s de Vig√™ncia:</label>
<select id="filtroMes">
<option value="todos">Mostrar Todos</option>
<option value="01">Janeiro</option><option value="02">Fevereiro</option><option value="03">Mar√ßo</option>
<option value="04">Abril</option><option value="05">Maio</option><option value="06">Junho</option>
<option value="07">Julho</option><option value="08">Agosto</option><option value="09">Setembro</option>
<option value="10">Outubro</option><option value="11">Novembro</option><option value="12">Dezembro</option>
</select>
</section>

<!-- √ÅREA DO DASHBOARD (usada no PDF) -->
<main class="container" id="dashboardArea">
<!-- KPIs - AGORA COM 4 CARDS -->
<section class="kpi-container">
<div class="kpi-card">
<h3>Total de Vagas</h3>
<p id="kpiVagas">0</p>
</div>
<div class="kpi-card">
<h3>% Vagas Retorno</h3>
<p id="kpiRetorno">0%</p>
</div>
<div class="kpi-card">
<h3>Profissionais</h3>
<p id="kpiProfissionais">0</p>
</div>
<div class="kpi-card">
<h3>Procs. √önicos</h3>
<p id="kpiProcedimentos">0</p>
</div>
</section>

<!-- GRID DE GR√ÅFICOS - [ALTERADO SOMENTE AQUI] -->
<section class="dashboard-grid">

  <div class="card">
    <h3>üîÑ Taxa de Renova√ß√£o</h3>
    <canvas id="gaugeChart"></canvas>
    <div id="percText" class="gauge-percentage">0%</div>
    <p class="gauge-label">Capacidade de absor√ß√£o de novos pacientes</p>
  </div>
  
  <!-- Card 2: Composi√ß√£o da Escala (substitui "Oferta por Hor√°rio") -->
  <div class="card">
    <h3>üìä Composi√ß√£o da Escala</h3>
    <canvas id="donutChart"></canvas>
    <div id="totalVagas" class="donut-total">Total: 0 Vagas</div>
  </div>

  <!-- Card 3: Evolucao da oferta -->
  <div class="card full-width">
    <h3>üìà Evolu√ß√£o de Oferta Mensal</h3>
    <p class="chart-subtitle">Acompanhamento de Vagas (1¬™ Vez vs. Retorno)</p>
    <div class="chart-wrapper">
      <canvas id="evolutionChart"></canvas>
    </div>
  </div>
  
  <div class="card full-width" id="cardInsights">
    <h3>üß† Insights Autom√°ticos</h3>
    <ul id="listaInsights"></ul>
  </div>

  <!-- (Opcional) se seu JS da Fase 3 usar KPI de m√©dia -->
  <span id="kpiMedia" style="display:none;"></span>

</section>

<!-- TABELA (OCULTA) -->
<section id="secTabela" class="card full-width" style="margin-top:20px;">
<h3>üìã Tabela Detalhada</h3>
<div style="overflow:auto;">
<table id="tabEscalas">
<thead>
<tr>
<th>CPF</th>
<th>Profissional</th>
<th>C√≥d. Proc.</th>
<th>Procedimento</th>
<th>Exames</th>
<th>Dias</th>
<th>In√≠cio</th>
<th>Fim</th>
<th>Vagas</th>
<th>Vig. In√≠cio</th>
<th>Vig. Fim</th>
</tr>
</thead>
<tbody id="corpoTabela"></tbody>
</table>
</div>
</section>
</main>

<!-- FOOTER -->
<footer id="footerCreditos"></footer>

<!-- Scripts - ORDEM CR√çTICA -->
<script src="js/config.js"></script>
<script src="js/dashboard.js"></script>
</body>
</html>
