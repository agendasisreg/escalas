<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard | Agenda SISREG</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap" rel="stylesheet">
<link rel="stylesheet" href="css/theme.css">
<link rel="stylesheet" href="css/style.css">
<!-- Bibliotecas externas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- [NOVO - SOMENTE PARA GRÃFICOS] D3 + Sankey -->
<script src="https://d3js.org/d3.v7.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/d3-sankey@0.12.3/dist/d3-sankey.min.js"></script>

<script src="https://cdn.jsdelivr.net/npm/html2canvas@1.4.1/dist/html2canvas.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>
<style>
/* Estilos adicionais para espaÃ§amento */
.dashboard-grid {
  margin-top: 30px; /* EspaÃ§amento entre KPIs e grÃ¡ficos */
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 24px;
}

.card.full-width {
  grid-column: 1 / -1;
}

/* BotÃ£o toggle dentro do card Insights */
#cardInsights .card-head {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 12px;
  margin-bottom: 10px;
}

#cardInsights .card-head h3 {
  margin: 0;
}

/* Tabela oculta por padrÃ£o */
#secTabela {
  display: none;
}

/* [CORREÃ‡ÃƒO] Posicionamento dos botÃµes na margem direita */
.header-btns {
  display: flex;
  align-items: center;
  gap: 10px;
  flex-wrap: wrap;
  justify-content: flex-end;
}

/* [NOVO - SOMENTE PARA GRÃFICOS] Tooltip D3 */
#vizTooltip{
  position: fixed;
  z-index: 9999;
  pointer-events: none;
  background: rgba(15,16,20,0.92);
  color: #fff;
  padding: 10px 12px;
  border-radius: 10px;
  font-size: 12px;
  line-height: 1.35;
  display: none;
  max-width: 260px;
  box-shadow: 0 10px 25px rgba(0,0,0,.18);
}
</style>
</head>
<body>

<!-- Tooltip para grÃ¡ficos D3 -->
<div id="vizTooltip"></div>

<!-- HEADER -->
<header class="dash-header">
  <!-- Elementos decorativos -->
  <div class="header-decorative circle-1"></div>
  <div class="header-decorative circle-2"></div>
  <div class="header-decorative circle-3"></div>
    
  <div class="unit-info">
    <h1 id="txtUnidade">Carregando unidade...</h1>
    <div class="gradient-line"></div>
    <p>Painel Gerencial de Escalas â€¢ <strong>SISREG Amazonas</strong></p>
  </div>

  <div style="display:flex;justify-content:space-between;align-items:center;position:relative;z-index:2;">
    <div class="header-btns">
      <button id="btnSincronizar" class="btn-main btn-sync">ğŸ”„ Sincronizar</button>
      <button id="btnExportarPDF" class="btn-main">ğŸ“„ Exportar PDF</button>
      <a href="escalas.html" style="text-decoration:none;">
      <button class="btn-main btn-new">â• Nova Escala</button>
      </a>
      <button id="btnLogout" class="btn-main btn-logout">Sair</button>
    </div>
  </div>
</header>

<!-- FILTRO -->
<section class="filter-section">
<label for="filtroMes">Filtrar por MÃªs de VigÃªncia:</label>
<select id="filtroMes">
<option value="todos">Mostrar Todos</option>
<option value="01">Janeiro</option><option value="02">Fevereiro</option><option value="03">MarÃ§o</option>
<option value="04">Abril</option><option value="05">Maio</option><option value="06">Junho</option>
<option value="07">Julho</option><option value="08">Agosto</option><option value="09">Setembro</option>
<option value="10">Outubro</option><option value="11">Novembro</option><option value="12">Dezembro</option>
</select>
</section>

<!-- ÃREA DO DASHBOARD (usada no PDF) -->
<main class="container" id="dashboardArea">
<!-- KPIs - AGORA COM 4 CARDS -->
<section class="kpi-container">
<div class="kpi-card">
<h3>Total de Vagas</h3>
<p id="kpiVagas">0</p>
</div>
<div class="kpi-card">
<h3>% Vagas Retorno</h3>
<p id="kpiRetorno">0%</p>
</div>
<div class="kpi-card">
<h3>Profissionais</h3>
<p id="kpiProfissionais">0</p>
</div>
<div class="kpi-card">
<h3>Procs. Ãšnicos</h3>
<p id="kpiProcedimentos">0</p>
</div>
</section>

<!-- GRID DE GRÃFICOS - [ALTERADO SOMENTE AQUI] -->
<section class="dashboard-grid">

  <div class="card">
    <h3>ğŸŒ€ PadrÃ£o de Oferta (Radial)</h3>
    <svg id="chartRadial" style="width:100%; height: 320px;"></svg>
  </div>

  <div class="card">
    <h3>âš–ï¸ EficiÃªncia por Profissional (Bubble)</h3>
    <canvas id="chartEficiÃªncia"></canvas>
  </div>

  <div class="card">
    <h3>ğŸŒŠ Fluxo por HorÃ¡rio (Stream)</h3>
    <svg id="chartStream" style="width:100%; height: 320px;"></svg>
  </div>

  <div class="card">
    <h3>ğŸ”€ Fluxo Dia â†’ Profissional â†’ Tipo (Sankey)</h3>
    <svg id="chartSankey" style="width:100%; height: 320px;"></svg>
  </div>

  <div class="card full-width" id="cardInsights">
    <h3>ğŸ§  Insights AutomÃ¡ticos</h3>
    <ul id="listaInsights"></ul>
  </div>

  <!-- (Opcional) se seu JS da Fase 3 usar KPI de mÃ©dia -->
  <span id="kpiMedia" style="display:none;"></span>

</section>

<!-- TABELA (OCULTA) -->
<section id="secTabela" class="card full-width" style="margin-top:20px;">
<h3>ğŸ“‹ Tabela Detalhada</h3>
<div style="overflow:auto;">
<table id="tabEscalas">
<thead>
<tr>
<th>CPF</th>
<th>Profissional</th>
<th>CÃ³d. Proc.</th>
<th>Procedimento</th>
<th>Exames</th>
<th>Dias</th>
<th>InÃ­cio</th>
<th>Fim</th>
<th>Vagas</th>
<th>Vig. InÃ­cio</th>
<th>Vig. Fim</th>
</tr>
</thead>
<tbody id="corpoTabela"></tbody>
</table>
</div>
</section>
</main>

<!-- FOOTER -->
<footer id="footerCreditos"></footer>

<!-- Scripts - ORDEM CRÃTICA -->
<script src="js/config.js"></script>
<script src="js/dashboard.js"></script>
</body>
</html>
